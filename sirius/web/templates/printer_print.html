{% extends "base.html" %}

{% block title %}Print{% endblock %}

{% block page_content %}
<h1>Print a thing on {{ printer.name }}</h1>

<form method="POST">
	{{ form.csrf_token }}
	<div class="form-group {% if form.target_printer.errors %}has-error{% endif%}">
		<label>{{ form.target_printer.label }}</label>
		{% if form.target_printer.errors %}
		<ul>
		{% for error in form.target_printer.errors %}
		<li>{{ error }}</li>
		{% endfor %}
		</ul>
		{% endif %}
		{{ form.target_printer(class="form-control") }}
	</div>
	<div class="form-group {% if form.message.errors %}has-error{% endif%}">
		<label>{{ form.message.label }}</label>
		{% if form.message.errors %}
		<ul>
		{% for error in form.message.errors %}
		<li>{{ error }}</li>
		{% endfor %}
		</ul>
		{% endif %}
		{{ form.message(class="form-control") }}
	</div>
	<button type="submit" class="btn btn-default">Print now</button>
</form>
<br>
<button class="btn" type="button" id="preview">Preview</button>

Preview:
<div id="preview_pane" style="width: 6cm;border: 1px solid black;">
</div>
{% endblock %}

{% block scripts %}
{{ super() }}

<script>
        $("#preview").on('click', function() {
        $.ajax({
          url: "{{ url_for('printer_print.preview',
                          user_id=current_user.id,
                          username=current_user.username,
                          printer_id=printer.id) }}",
          data: $("#message").val(),
	  method: "POST",
	  contentType: "text/plain",
          success: function(response) {
          $("#preview_pane").html(response);
            console.log(response);
          }
	})
	})
</script>
{% endblock scripts%}
